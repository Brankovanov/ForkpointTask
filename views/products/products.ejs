<%- include ../header.ejs %>
    <div class="products-wrapper">
        <div class="container-fluid">
            <div class="container">
                <nav aria-label="breadcrumb ">
                    <ol class="breadcrumb bg-white px-0">
                        <li class="breadcrumb-item active" aria-current="page">
                            <a href="/">Home</a>
                        </li>
                        <% let link=""; 
                        let string = results[0].primary_category_id
                        .split('-');
                        for (let index = 0; index < string.length; index++) {
                            const element = string[index];
                            link+=element+"-";
                            let links =link.slice(0, -1);
                            if(index== string.length-1){%>
                            <li class="breadcrumb-item active" aria-current="page">
                                <a href="/subcategories/:<%=links%>">
                                    <% let name = element.charAt(0).toUpperCase() + element.slice(1) %>
                                        <%=name%>
                                </a>
                            </li>
                            <%}else{%>
                                <li class="breadcrumb-item active" aria-current="page">
                                    <a href="/categories/:<%=links%>">
                                        <% let name = element.charAt(0).toUpperCase() + element.slice(1) %>
                                            <%=name%>
                                    </a>
                                </li>
                                <%   }
                             }%>

                                    <li class="breadcrumb-item active" aria-current="page">
                                        <%=results[0].name%>
                                    </li>
                    </ol>
                </nav>
            </div>
        </div>
        <div class="container-fluid">
            <div class="container">
                <div class="row pt-5 h-100">
                    <div class="col-6">
                        <div id="carouselExampleCaptions" class="carousel slide" data-ride="carousel">
                            <div class="carousel-inner">
                                <% let counter=0; %>
                                    <% results.forEach((productResult) => { %>
                                        <% productResult.image_groups.forEach(element => { %>
                                            <% if(element.view_type=="large"){ %>
                                                <% element.images.forEach(image => { %>
                                                    <% if(counter==0){ %>
                                                        <div class="carousel-item active">
                                                            <% counter++ %>
                                                                <% } else { %>
                                                                    <div class="carousel-item">
                                                                        <% } %>
                                                                            <img src="/images/<%= image.link%>" class="d-block w-100" alt="<%=image.alt%>">
                                                                            <div class="carousel-caption d-none d-md-block text-dark">
                                                                                <p class="text-center">
                                                                                    <%=image.title%>
                                                                                </p>
                                                                            </div>
                                                                    </div>
                                                                    <%  });%>
                                                                        <% }%>
                                                                            <% });%>
                                                                                <% }); %>
                                                        </div>
                                                        <a class="carousel-control-prev" href="#carouselExampleCaptions" role="button" data-slide="prev">
                                                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                                            <span class="sr-only">Previous</span>
                                                        </a>
                                                        <a class="carousel-control-next" href="#carouselExampleCaptions" role="button" data-slide="next">
                                                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                                            <span class="sr-only">Next</span>
                                                        </a>
                            </div>
                        </div>
                        <div class="col-6 text-center ">
                            <% results.forEach(body => { %>
                                <h3 class="h-25">
                                    <%=body.name%>
                                </h3>
                                <p class="h-50">
                                    <%=body.long_description%>
                                </p>
                                <%results.forEach(element => {%>
                                    <form action="/products/:<%=element.id%>" method="POST">
                                        <%  });%>
                                            <div class="row">
                                                <% body.variation_attributes.forEach(attribute => { %>
                                                    <div class="col-4">
                                                        <label for="<%=attribute.id%>"><%=attribute.id%></label>

                                                        <select name="<%=attribute.id%>" id="<%=attribute.id%>" onchange="this.form.submit()">
                                                            <%  attribute.values.forEach(attributeValue => { %>
                                            <% if(filterValues != null && filterValues[attribute.id]==attributeValue.value){%> 
                                                <option value="<%=attributeValue.value%>" selected><%=attributeValue.name%></option>          
                                                <%}}); %>     
                                          <%  attribute.values.forEach(attributeValue => { %>
                                            <% if(filterValues != null && attributeValue.orderable==true && filterValues[attribute.id]!=attributeValue.value){%> 
                                                <option value="<%=attributeValue.value%>"><%=attributeValue.name%></option>          
                                                <%}else { %>  
                                                    <option value="<%=attributeValue.value%>"><%=attributeValue.name%></option>          
                                                       <% } %>
                                         <% }); %>
                                        </select>
                                                    </div>
                                                    <%  });%>
                                            </div>
                                    </form>
                                    <p>
                                        <%=filters%>
                                    </p>
                                    <div class="row">
                                        <div class="col">
                                            <%= body.price %>
                                                <%= body.currency  %>
                                        </div>
                                        <div class="col d-flex justify-content-end">
                                            <% if(body.orderable==true) { %>
                                                <a href="" class="btn btn-primary">Buy now</a>
                                                <% } else {%>
                                                    <a href="" class="btn btn-primary" disabled>Buy now</a>
                                                    <% } %>
                                        </div>
                                    </div>
                                    <% }); %>

                        </div>
                    </div>
                </div>
            </div>
        </div>
        <%- include ../footer.ejs %>